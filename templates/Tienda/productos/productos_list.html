{% extends 'Tienda/base.html' %}

{% block title %}Lista de Productos - {{ block.super }}{% endblock %}

{% block content %}
<div class="row mb-3">
  <div class="col">
    <!-- Botón para agregar nuevo producto -->
    <a href="{% url 'Tienda:producto_create' %}" class="btn btn-success">
      <i class="fas fa-plus"></i> Nuevo Producto
    </a>
  </div>
</div>

<div class="row">
  <div class="col">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">
          <i class="fas fa-box"></i> Lista de Productos
        </h5>
      </div>
      <div class="card-body">
        {% if productos %}
          <div class="table-responsive">
            <table class="table table-striped table-hover align-middle">
              <thead class="table-dark">
                <tr>
                  <th>ID</th>
                  <th>Nombre</th>
                  <th class="text-end">Precio</th>
                  <th class="text-end">Stock</th>
                  <th class="text-end">Mínimo</th>
                  <th>Estado</th>
                  <th class="text-end">Acciones</th>
                </tr>
              </thead>
              <tbody>
              {% for producto in productos %}
                {% with cm=producto.cantidad_minima|default:5 %}
                <tr>
                  <td>{{ producto.id }}</td>
                  <td><strong>{{ producto.nombre }}</strong></td>
                  <td class="text-end">${{ producto.precio|floatformat:0 }}</td>
                  <td class="text-end">{{ producto.stock }}</td>
                  <td class="text-end">{{ cm }}</td>
                  <td>
                    {% if producto.stock < cm %}
                      <span class="badge bg-danger">
                        <i class="fas fa-exclamation-triangle"></i> Stock Bajo
                      </span>
                    {% elif producto.stock < cm|add:5 %}
                      <span class="badge bg-warning">
                        <i class="fas fa-exclamation-circle"></i> Stock Limitado
                      </span>
                    {% else %}
                      <span class="badge bg-success">
                        <i class="fas fa-check-circle"></i> Stock Normal
                      </span>
                    {% endif %}
                  </td>
                  <td class="text-end">
                    <div class="btn-group" role="group">
                      <a href="{% url 'Tienda:producto_edit' producto.id %}"
                         class="btn btn-sm btn-outline-primary" title="Editar">
                        <i class="fas fa-edit"></i>
                      </a>
                      <a href="{% url 'Tienda:producto_delete' producto.id %}"
                         class="btn btn-sm btn-outline-danger" title="Eliminar">
                        <i class="fas fa-trash"></i>
                      </a>
                    </div>
                  </td>
                </tr>
                {% endwith %}
              {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <!-- Mensaje cuando no hay productos -->
          <div class="text-center py-5">
            <i class="fas fa-box-open fa-3x text-muted mb-3"></i>
            <h5 class="text-muted">No hay productos registrados</h5>
            <p class="text-muted">Comienza agregando tu primer producto al sistema.</p>
            <a href="{% url 'Tienda:producto_create' %}" class="btn btn-primary">
              <i class="fas fa-plus"></i> Agregar Primer Producto
            </a>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Leyenda de estados -->
<div class="row mt-4">
  <div class="col">
    <div class="card">
      <div class="card-header">
        <h6 class="card-title mb-0">
          <i class="fas fa-info-circle"></i> Información sobre Estados de Stock
        </h6>
      </div>
      <div class="card-body">
        <div class="row gy-2">
          <div class="col-md-4">
            <span class="badge bg-success me-2">Stock Normal</span>
            Más de 5 unidades sobre el mínimo
          </div>
          <div class="col-md-4">
            <span class="badge bg-warning me-2">Stock Limitado</span>
            Dentro de 5 unidades del mínimo
          </div>
          <div class="col-md-4">
            <span class="badge bg-danger me-2">Stock Bajo</span>
            Por debajo del mínimo requerido
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
